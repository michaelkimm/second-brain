
[![\[!\[Alt text\](<img/토스 데이터 설계 사상.png)](<img/토스 데이터 설계 사상.png>)](https://www.youtube.com/watch?v=KoLObZ9A3Kc&t=1s)


# 1. 데이터 설계의 중요성
- 데이터 설계의 핵심은 효율적인 읽기와 쓰기
- 데이터를 기반으로 한 집합적인 사고 필요
- 프로그래밍을 반복 개발하여 경험하는 순차지향적인 사고로 인해 데이터를 기반한 집합적인 사고를 못하게 되어 데이터 설계에 어려움 존재

<br>
<br>

# 2. 테이블의 통합과 분리
![!\[Alt text\](<img/스크린샷 2023-08-02 오후 1.52.03.png>)](<img/테이블의 통합과 분리 대출카드.png>)

- 업무에 따라 통합과 분리를 판단해야함.
- [분리] 심사는 평가 항목이 대출/카드가 상이한 항목이 많음.
- [분리] 테이블을 심사 내역 하나로 통합했을 때 불리한 점이 많음.
- [통합] 연체 이후는 대출이나 카드나 연체 금액, 연체일 등 공통적인 항목이 많음.
- [통합] 이후에 발생하는 법적 절차 테이블들은 고객별 데이터임. 따라서 통합이 더 효율적임.

_*정답이란 없음. 설계자의 판단이 중요함. 프로그램 본 수량, 소스량, 개발 시간등의 효율 고려 필요_

![!\[Alt text\](<img/스크린샷 2023-08-02 오후 2.09.40.png>)](<img/테이블의 통합과 분리 이론.png>)

<br>


## 1) 개별 테이블 예시: 대출
![!\[Alt text\](<img/스크린샷 2023-08-02 오후 2.33.43.png>)](img/%EA%B0%9C%EB%B3%84%ED%85%8C%EC%9D%B4%EB%B8%94%EC%98%88%EC%8B%9C%EB%8C%80%EC%B6%9C.png)

- 테이블의 대표 속성: 여신대출기본(실행금액), 수신대출기본(한도금액), 마이너스통장기본(개시잔액, 최고잔액)
- 업무 별로 하위 속성이 다름 -> 테이블 분리

#### 장점
- 확장성, 업무 독립성 보장: 컬럼 추가시 각 테이블에서 컬럼을 추가하면 됨.
#### 단점
- 관리 용이성 낮음: 테이블 별 거래내역을 따로 만들어야함. 또한 SQL 조인 시에도 각각 조인해야함

<br>

## 2) 슈퍼+서브 테이블 예시: 대출
![!\[Alt text\](<img/스크린샷 2023-08-02 오후 2.32.45.png>)](img/%EC%8A%88%ED%8D%BC%EC%84%9C%EB%B8%8C%ED%85%8C%EC%9D%B4%EB%B8%94%EC%98%88%EC%8B%9C%EB%8C%80%EC%B6%9C.png)
![!\[Alt text\](<img/스크린샷 2023-08-02 오후 2.37.54.png>)](img/%EC%8A%88%ED%8D%BC%EC%84%9C%EB%B8%8C%ED%85%8C%EC%9D%B4%EB%B8%94%EC%98%88%EC%8B%9C%EB%8C%80%EC%B6%9C-%EA%B1%B0%EB%9E%98%EB%82%B4%EC%97%AD.png)
- 대출기본에 공통 속성
- 서브 테이블에 개별 속성

#### 장점
- 조인 성능(테이블 조인 시, 대출기본 하나의 테이블과 조인해도 공통 속성 조회 가능)
- 거래내역 테이블도 대출거래내역 한 개로 구성 가능
#### 단점
- 여신대출기본, 수신대출기본의 개별 속성을 조회할 땐 각각의 개별 테이블과 조회 해야함.

<br>


## 3) 통합 테이블 예시: 대출
![!\[Alt text\](<img/스크린샷 2023-08-02 오후 2.39.32.png>)](img/%ED%86%B5%ED%95%A9%ED%85%8C%EC%9D%B4%EB%B8%94%EC%98%88%EC%8B%9C%EB%8C%80%EC%B6%9C.png)
- 여수신대출기본 하나의 테이블로 조인해도 모든 정보 조회 가능
- 대출 거래 내역도 하나만 존재

#### 장점
- 조인 성능 우수
- 관리 용이성 좋음
#### 단점
- 여러 프로그램에서 하나의 테이블만 바라봄.
- 테이블 ALTER가 빈번함.
- 테이블 프로그램 오너십 문제 존재.
- 대량의 데이터 발생 -> 성능 저하 이슈 -> 인덱스 파티션 전략 중요

<br>
<br>

## 해법은?
- 공통 분모를 모으자
- 데이터량/트랜잭션의 유형 고려
- 데이터양이 적으면 성능상 이슈가 없기 때문에 되도록 통합이 좋음.
- 데이터양이 많으면 슈퍼/서브 테이블로 분리하는 것이 좋음. 사용자 경험을 해치지 않는 가정하에 트랜잭션을 분리해서 공통적인 속성을 먼저 입력 후 개별적인 속성은 팝업으로 입력하도록 담당자에게 업무 변경을 유도하는 것도 좋은 방법.

<br>
<br>

## 나만의 요약
### Bullet point
- ✅ 데이터 설계 시, 효율적인 읽기를 어떻게 할지 고려
  - <span style="color: #808080"> ex) 사용자가 많이 사용할 기능 & join 성능 </span>
- ✅ 데이터 설계 시, 효율적인 쓰기를 어떻게 할지 고려
  - <span style="color: #808080"> ex) 데이터 양이 많아져 index 성능 감소 가능 </span>
- 🌟 집합적인 사고를 바탕하여 업무에 따라 성능을 고려하여 통합&슈퍼-서브&분리를 판단 필요

<br>

| 종류 | 장점 | 단점 | 비고 |
|---|:---:|---:|---:|
| 통합 | 모든 속성 이용한 join 성능 향상 | 테이블 관리 주체 불명확, 확장성 낮음 | 데이터 양 적을 경우 |
| 슈퍼-서브 | 공통 속성 join 성능 향상 | 개별 테이블 join 필요 | 공통 속성 다수 존재할 경우 |
| 분리 | 확장성, 테이블 관리 주체 명확 | 개별 테이블 join 성능 bad, 테이블이 과도하게 커짐(파티션 고려 필요) | |
